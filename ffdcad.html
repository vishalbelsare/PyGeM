

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Free-form Deformation [CAD] &mdash; PyGeM 2.0.0 documentation</title>
  

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/graphviz.css" type="text/css" />

  
  
  
  

  
  <!--[if lt IE 9]>
    <script src="_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Radial Basis Function [CAD]" href="rbfcad.html" />
    <link rel="prev" title="CAD Deformation" href="cad_deformation.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home" alt="Documentation Home"> PyGeM
          

          
          </a>

          
            
            
              <div class="version">
                2.0.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="code.html">Code Documentation</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="ffd.html">Free-form Deformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbf.html">Radial Basis Function</a></li>
<li class="toctree-l2"><a class="reference internal" href="rbf_factory.html">RBF Factory</a></li>
<li class="toctree-l2"><a class="reference internal" href="idw.html">Inverse Distance Weighting</a></li>
<li class="toctree-l2"><a class="reference internal" href="custom_deformation.html">Custom Deformation</a></li>
<li class="toctree-l2"><a class="reference internal" href="filehandler.html">Filehandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="vtkhandler.html">Vtkhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="stlhandler.html">Stlhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="openfhandler.html">Openfhandler</a></li>
<li class="toctree-l2"><a class="reference internal" href="unvhandler.html">Unvhandler</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="code.html#cad">CAD</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cad_deformation.html">CAD Deformation</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Free-form Deformation [CAD]</a></li>
<li class="toctree-l3"><a class="reference internal" href="rbfcad.html">Radial Basis Function [CAD]</a></li>
<li class="toctree-l3"><a class="reference internal" href="idwcad.html">Inverse Distance Weighting [CAD]</a></li>
<li class="toctree-l3"><a class="reference internal" href="custom_deformation_cad.html">Custom Deformation [CAD]</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="code.html#table-of-contents">Table of contents</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="tutorials.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="contact.html">Contact</a></li>
<li class="toctree-l1"><a class="reference internal" href="contributing.html">How to contribute</a></li>
<li class="toctree-l1"><a class="reference internal" href="LICENSE.html">License</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">PyGeM</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="code.html">Code Documentation</a> &raquo;</li>
        
      <li>Free-form Deformation [CAD]</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/ffdcad.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="module-pygem.cad.ffd">
<span id="free-form-deformation-cad"></span><h1>Free-form Deformation [CAD]<a class="headerlink" href="#module-pygem.cad.ffd" title="Permalink to this headline">¶</a></h1>
<p>Utilities for performing Free Form Deformation (FFD) to CAD geometries.</p>
<dl class="field-list">
<dt class="field-odd">Theoretical Insight</dt>
<dd class="field-odd"><p>Free Form Deformation is a technique for the efficient, smooth and accurate
geometrical parametrization. It has been proposed the first time in
<em>Sederberg, Thomas W., and Scott R. Parry. “Free-form deformation of solid
geometric models.” ACM SIGGRAPH computer graphics 20.4 (1986): 151-160</em>. It
consists in three different step:</p>
<ul class="simple">
<li><p>Mapping the physical domain to the reference one with map
<span class="math">\boldsymbol{\psi}</span>.  In the code it is named <em>transformation</em>.</p></li>
<li><p>Moving some control points to deform the lattice with <span class="math">\hat{T}</span>.
The movement of the control points is basically the weight (or
displacement) <span class="math">\boldsymbol{\mu}</span> we set in the <em>parameters file</em>.</p></li>
<li><p>Mapping back to the physical domain with map
<span class="math">\boldsymbol{\psi}^{-1}</span>.  In the code it is named
<em>inverse_transformation</em>.</p></li>
</ul>
<p>FFD map (<span class="math">T</span>) is the composition of the three maps, that is</p>
<div class="math">
<p><span class="math">T(\cdot, \boldsymbol{\mu}) = (\Psi^{-1} \circ \hat{T} \circ
\Psi) (\cdot, \boldsymbol{\mu})</span></p>
</div><p>In this way, every point inside the FFD box changes it position according to</p>
<div class="math">
<p><span class="math">\boldsymbol{P} = \boldsymbol{\psi}^{-1} \left( \sum_{l=0}^L
\sum_{m=0}^M \sum_{n=0}^N
\mathsf{b}_{lmn}(\boldsymbol{\psi}(\boldsymbol{P}_0))
\boldsymbol{\mu}_{lmn} \right)</span></p>
</div><p>where <span class="math">\mathsf{b}_{lmn}</span> are Bernstein polynomials.  We improve the
traditional version by allowing a rotation of the FFD lattice in order to
give more flexibility to the tool.</p>
<p>You can try to add more shapes to the lattice to allow more and more
involved transformations.</p>
</dd>
</dl>
<table class="longtable docutils align-default">
<colgroup>
<col style="width: 10%" />
<col style="width: 90%" />
</colgroup>
<tbody>
</tbody>
</table>
<dl class="py class">
<dt>
<em class="property">class </em><code class="sig-name descname">FFD</code><span class="sig-paren">(</span><em class="sig-param"><span class="n">n_control_points</span><span class="o">=</span><span class="default_value">None</span></em>, <em class="sig-param"><span class="n">u_knots_to_add</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">v_knots_to_add</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">t_knots_to_add</span><span class="o">=</span><span class="default_value">0</span></em>, <em class="sig-param"><span class="n">tolerance</span><span class="o">=</span><span class="default_value">0.0001</span></em><span class="sig-paren">)</span><a class="reference internal" href="_modules/pygem/cad/ffd.html#FFD"><span class="viewcode-link">[source]</span></a></dt>
<dd><p>Bases: <code class="xref py py-class docutils literal notranslate"><span class="pre">pygem.cad.cad_deformation.CADDeformation</span></code>, <code class="xref py py-class docutils literal notranslate"><span class="pre">pygem.ffd.FFD</span></code></p>
<p>Class that handles the Free Form Deformation on CAD geometries.</p>
<dl class="field-list">
<dt class="field-odd">Parameters</dt>
<dd class="field-odd"><ul class="simple">
<li><p><strong>n_control_points</strong> (<a class="reference external" href="https://docs.python.org/3/library/stdtypes.html#list" title="(in Python v3.8)"><em>list</em></a>) – number of control points in the x, y, and z
direction. If not provided it is set to [2, 2, 2].</p></li>
<li><p><strong>u_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS surfaces
along <cite>u</cite> direction before the deformation. This parameter is useful
whenever the gradient of the imposed deformation present spatial scales
that are smaller than the local distance among the original poles of
the surface/curve. Enriching the poles will allow for a more accurate
application of the deformation, and might also reduce possible
mismatches between bordering faces. On the orther hand, it might result
in higher computational cost and bigger output files. Default is 0.</p></li>
<li><p><strong>v_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS surfaces
along <cite>v</cite> direction before the deformation. This parameter is useful
whenever the gradient of the imposed deformation present spatial scales
that are smaller than the local distance among the original poles of
the surface/curve. Enriching the poles will allow for a more accurate
application of the deformation, and might also reduce possible
mismatches between bordering faces. On the orther hand, it might result
in higher computational cost and bigger output files.  Default is 0.</p></li>
<li><p><strong>t_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS curves
before the deformation. This parameter is useful whenever the gradient
of the imposed deformation present spatial scales that are smaller than
the local distance among the original poles of the surface/curve.
Enriching the poles will allow for a more accurate application of the
deformation, and might also reduce possible mismatches between
bordering faces. On the orther hand, it might result in higher
computational cost and bigger output files. Default is 0.</p></li>
<li><p><strong>tolerance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – the tolerance involved in several internal
operations of the procedure (joining wires in a single curve before
deformation and placing new poles on curves and surfaces). Change the
default value only if the input file scale is significantly different
form mm, making some of the aforementioned operations fail. Default is
0.0001.</p></li>
</ul>
</dd>
<dt class="field-even">Variables</dt>
<dd class="field-even"><ul class="simple">
<li><p><strong>box_length</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – dimension of the FFD bounding box, in the
x, y and z direction (local coordinate system).</p></li>
<li><p><strong>box_origin</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – the x, y and z coordinates of the origin of
the FFD bounding box.</p></li>
<li><p><strong>rot_angle</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – rotation angle around x, y and z axis of the
FFD bounding box.</p></li>
<li><p><strong>n_control_points</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – the number of control points in the
x, y, and z direction.</p></li>
<li><p><strong>array_mu_x</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
x, normalized with the box length x.</p></li>
<li><p><strong>array_mu_y</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
y, normalized with the box length y.</p></li>
<li><p><strong>array_mu_z</strong> (<a class="reference external" href="https://numpy.org/doc/stable/reference/generated/numpy.ndarray.html#numpy.ndarray" title="(in NumPy v1.19)"><em>numpy.ndarray</em></a>) – collects the displacements (weights) along
z, normalized with the box length z.</p></li>
<li><p><strong>u_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS surfaces
along <cite>u</cite> direction before the deformation. This parameter is useful
whenever the gradient of the imposed deformation present spatial scales
that are smaller than the local distance among the original poles of
the surface/curve. Enriching the poles will allow for a more accurate
application of the deformation, and might also reduce possible
mismatches between bordering faces. On the orther hand, it might result
in higher computational cost and bigger output files. Default is 0.</p></li>
<li><p><strong>v_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS surfaces
along <cite>v</cite> direction before the deformation. This parameter is useful
whenever the gradient of the imposed deformation present spatial scales
that are smaller than the local distance among the original poles of
the surface/curve. Enriching the poles will allow for a more accurate
application of the deformation, and might also reduce possible
mismatches between bordering faces. On the orther hand, it might result
in higher computational cost and bigger output files.  Default is 0.</p></li>
<li><p><strong>t_knots_to_add</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#int" title="(in Python v3.8)"><em>int</em></a>) – the number of knots to add to the NURBS curves
before the deformation. This parameter is useful whenever the gradient
of the imposed deformation present spatial scales that are smaller than
the local distance among the original poles of the surface/curve.
Enriching the poles will allow for a more accurate application of the
deformation, and might also reduce possible mismatches between
bordering faces. On the orther hand, it might result in higher
computational cost and bigger output files. Default is 0.</p></li>
<li><p><strong>tolerance</strong> (<a class="reference external" href="https://docs.python.org/3/library/functions.html#float" title="(in Python v3.8)"><em>float</em></a>) – the tolerance involved in several internal
operations of the procedure (joining wires in a single curve before
deformation and placing new poles on curves and surfaces). Change the
default value only if the input file scale is significantly different
form mm, making some of the aforementioned operations fail. Default is
0.0001.</p></li>
</ul>
</dd>
<dt class="field-odd">Example</dt>
<dd class="field-odd"><div class="doctest highlight-default notranslate"><div class="highlight"><pre><span></span><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pygem.cad</span> <span class="kn">import</span> <span class="n">FFD</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">pygem.cad</span> <span class="kn">import</span> <span class="n">CADDeformation</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffd</span> <span class="o">=</span> <span class="n">FFD</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffd</span><span class="o">.</span><span class="n">read_parameters</span><span class="p">(</span><span class="s1">&#39;parameters_test_ffd_iges.prm&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">input_cad_file_name</span> <span class="o">=</span> <span class="s2">&quot;input.iges&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">modified_cad_file_name</span> <span class="o">=</span> <span class="s2">&quot;output.iges&quot;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">ffd</span><span class="p">(</span><span class="n">input_cad_file_name</span><span class="p">,</span> <span class="n">modified_cad_file_name</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># is equivalent to</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">new_shape</span> <span class="o">=</span> <span class="n">ffd</span><span class="p">(</span><span class="n">CADDeformation</span><span class="o">.</span><span class="n">read_shape</span><span class="p">(</span><span class="n">input_cad_file_name</span><span class="p">))</span>
</pre></div>
</div>
</dd>
</dl>
</dd></dl>

</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rbfcad.html" class="btn btn-neutral float-right" title="Radial Basis Function [CAD]" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="cad_deformation.html" class="btn btn-neutral float-left" title="CAD Deformation" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        
        &copy; Copyright Copyright 2017-2020, PyGeM contributors
      <span class="lastupdated">
        Last updated on Jul 08, 2020.
      </span>

    </p>
  </div>
    
    
    
    Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>